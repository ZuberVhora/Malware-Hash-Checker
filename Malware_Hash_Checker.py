import sys
import os
import virustotal
import time
import shutil
import csv
try:
    file1 = open("config.md.txt", 'r')
    lines = file1.readlines()
    my_list = [line.split(' ') for line in open ("config.md")]
    print (my_list)
    filelocation = my_list[0][3]
    outlocation= my_list[2][3]
    api_key = my_list[4][3]
    file1.close
    flag=0
    # Get First Parameter Value
    # Get Second Parameter Value
    movefile=outlocation+"\\"+"ScannedFiles" # Create Scanned Files Output Path
    print "movefile",movefile
    if os.path.exists(movefile): # Check Path is Exist or Not
        print "Path is Already Exist"
    else:
        os.makedirs(movefile) #Create A Directory If It Is Not Exist.
    print "File Location is : ",filelocation
    filestr=filelocation[::-1]
    index=filestr.find("\\")
    fname=filestr[:index]
    foldername=fname[::-1]
    print 'Output location is : ',outlocation
    print 'Number of Arguments : ',len(sys.argv),' Arguments.'
    print 'Argument List : ',str(sys.argv)
    print 'Number of Files Are : ',len(os.listdir(filelocation))
    filename=outlocation+"\\ScannedReport.csv"
    print "file Name Is : ",filename
    with open(filename,"a") as fileobject:
        for file in os.listdir(filelocation):
            #temp=my_list[4][3]
            #api_key = temp.replace(" ", "")
            api_key="94dbc67d2f667c182d8de509877fc98765a7c5e94e6662b2afca817f3ea8c482"
            key="Tm90IFlldC4gVHJ5SGFyZGVy"
            print "api_key",api_key,"end"
            print "length",len(api_key)
            counter=0
            print "file name is ",file
            v = virustotal.VirusTotal(api_key)
            print "\n\t 1",v
            print "file is",file
            report=""
            print "report ",report
            report = v.get(file)
            if report.done:
                # Read the report
                # Wait for the report to be ready
                report.join()
                assert report.done == True
                for antivirus, malware in report:
                    if malware is not None:
                        val1=foldername
                        val2=file
                        val3=malware
                        data=[val1,val2,val3]
                        #list=list + int(foldername)
                        #list.append(str(file))
                        #list.append(str(malware))
                        writer=csv.writer(fileobject)
                        writer.writerow(data)
                        srcfile=filelocation+"\\"+ file
                        dstfile=movefile+"\\"+ file
                        print "source file ", srcfile
                        print "Destination ", dstfile
                        #os.rename(srcfile,dstfile)
                        shutil.move(srcfile,dstfile)
                        print file+" is Scanning Please Wait.."
                        counter=counter+1
                        if counter%4==1:
                            counter=0
                            time.sleep(60)
                            print "list is :",list
                            print "folder name ",foldername
                            print "file ",file
                            print "malware : ",malware
                            print "Done.."
                            break
                    else:
                        print "Result not found"
except Exception,e:
    print "[-] Runtime Errors :"
    if len(str(e))==0:
        print "\t\t [-] Internal Module Error"
    else:
        print "\t\t[-] : ",str(e)

